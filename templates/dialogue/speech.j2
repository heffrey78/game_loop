{# Enhanced Dialogue Template #}
{% if npc_data and npc_data.name -%}
[bold magenta]{{ npc_data.name }}:[/bold magenta] {% if emotion %}[italic dim]({{ emotion }})[/italic dim] {% endif %}"{{ text | rich_markup }}"
{%- else -%}
[bold magenta]{{ speaker }}:[/bold magenta] {% if emotion %}[italic dim]({{ emotion }})[/italic dim] {% endif %}"{{ text | rich_markup }}"
{%- endif %}
{%- if metadata and metadata.get('internal_thought') %}
[dim]{{ speaker }} thinks: {{ metadata.internal_thought }}[/dim]
{%- endif %}
